#!/usr/bin/env sh

if [ -f '/etc/profile' ]; then
	. '/etc/profile'
fi

if [ "$PWD" = "$HOME" ]; then
	last_tmux_sess="$(tmux ls -F '#{session_activity} #{session_attached} #{session_name}' 2> /dev/null | sort -nr | awk '$2 == "0" { print $3 }' | head -1)"
	if [ -n "$last_tmux_sess" ]; then
		tmux a -t "$last_tmux_sess"
	else
		tmux
	fi
else
	last_tmux_sess="$(tmux ls -F '#{session_activity} #{session_attached} #{pane_current_path} #{session_name}' 2> /dev/null | sort -nr | awk -v "pwd=$PWD" '$2 == "0" && $3 == pwd { print $4 }' | head -1)"
	if [ -n "$last_tmux_sess" ]; then
		tmux a -t "$last_tmux_sess"
	else
		tmux
	fi
fi
